---
version: '1.0.0'

environment:
  defaultServices:
    - name: 'lc-test'
    - name: 'helm-postgres'
    - name: 'helm-redis'
    - name: 'helm-mysql'
    - name: 'helm-elasticsearch'
    - name: 'helm-jenkins'

services:
  - name: 'lc-test'
    defaultUUID: 'good-dev-0'
    github:
      repository: 'vmelikyan/lc-test'
      branchName: 'main'
      docker:
        defaultTag: 'main'
        app:
          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'
          env:
            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'
          ports:
            - 8080
        init:
          dockerfilePath: 'sysops/dockerfiles/init.dockerfile'
      deployment:
        public: true
        capacityType: 'SPOT'
        resource:
          cpu:
            request: '10m'
          memory:
            request: '100Mi'
        readiness:
          tcpSocketPort: 8080
          httpGet:
            port: 8080

  - name: "helm-postgres"
    helm:
      name: 'postgresql'
      chart:
        values:
          - "auth.username=postgres"
          - "auth.password=vahanspassword"
        valueFiles:
          repository: 'vmelikyan/lc-test'
          branchName: 'main'
          paths:
            - 'sysops/helm/lfc/db/db.yaml'
  - name: 'helm-mysql'
    helm:
      name: 'mysql'
  - name: 'helm-redis'
    helm:
      name: 'redis'
  - name: 'helm-elasticsearch'
    helm:
      name: 'elasticsearch'
  - name: 'helm-jenkins'
    version: "3.7.2"
    cmdPs: "--reuse-values --debug --timeout 60m0s"
    action: "install",
    helm:
      name: 'jenkins'
      repoUrl: 'https://charts.bitnami.com/bitnami'
      version: '12.3.0'
      
