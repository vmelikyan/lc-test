---\nversion: '2.1.0'\nenvironment:\n  defaultServices:\n    - name: 'lc-test-helm-local'\n    - name: 'nginx'\n    - name: 'postgres-db'\n    - name: 'grpc-echo'\n    - name: 'redis'\n    - name: 'jenkins'\n    - name: 'lc-test-helm-oci'\n    - name: 'lc-test-gh-type'\nservices:\n  - name: 'lc-test-helm-local'\n    helm:\n      version: "3.12.0"\n      repository: 'vmelikyan/lc-test'\n      branchName: 'main'\n      args: "--debug"\n      envMapping:\n        app:\n          format: 'array'\n          path: 'deployment.env'\n      chart:\n        name: './helm/lc-apps' # local (in repo) helm chart\n        values:\n          - 'image=\"{{{lc-test-helm-local_dockerImage}}}\"'\n          - 'ingress.enabled=true'\n          - 'ingress.hostname={{{lc-test_publicUrl}}}'\n        valueFiles:\n          - 'sysops/helm/common.yaml'\n          - 'sysops/helm/lfc/service/app.yaml'\n      docker:\n        builder:\n          engine: 'buildkit'\n        defaultTag: 'main'\n        app:\n          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'\n          env:\n            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'\n            TEST_TEST: 'test'\n            WHAT: \"is-this\"\n          ports:\n            - 8080\n  - name: 'lc-test-helm-oci'\n    helm:\n      version: \"3.12.0\"\n      repository: 'vmelikyan/lc-test'\n      branchName: 'main'\n      args: \"--debug\"\n      envMapping:\n        app:\n          format: 'array'\n          path: 'deployment.env'\n      chart:\n        name: 'lc-apps'\n        repoUrl: 'oci://ghcr.io/vmelikyan/lc-apps' # oci chart\n        version: '0.0.1'\n        values:\n          - 'image=\"{{{lc-test-helm-oci_dockerImage}}}\"'\n          - 'ingress.enabled=true'\n          - 'ingress.hostname={{{lc-test_publicUrl}}}'\n        valueFiles:\n          - 'sysops/helm/common.yaml'\n          - 'sysops/helm/lfc/service/app.yaml'\n      docker:\n        builder:\n          engine: 'buildkit'\n        defaultTag: 'main'\n        app:\n          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'\n          env:\n            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'\n            TEST_TEST: 'test'\n            WHAT: \"is-this\"\n          ports:\n            - 8080\n  - name: \"grpc-echo\"\n    deploymentDependsOn:\n      - 'lc-test-gh-type'\n    helm:\n      version: \"3.12.0\"\n      repository: \"vmelikyan/lc-test\"\n      branchName: \"main\"\n      envMapping:\n        app:\n          format: 'array'\n          path: 'deployment.env'\n      chart:\n        name: './helm/lc-apps'\n        values:\n          - 'image=\"{{{grpc-echo_dockerImage}}}\"'\n        valueFiles:\n          - 'sysops/helm/common.yaml'\n          - 'sysops/helm/lfc/service/grpc-service.yaml'\n      docker:\n        builder:\n          engine: 'buildkit'\n        defaultTag: \"main\"\n        app:\n          dockerfilePath: \"grpc-echo/Dockerfile\"\n          ports:\n            - 8080\n          env:\n            COMPONENT: \"app\"\n            ENV: \"lifecycle\"\n  - name: \"lc-test-gh-type\"\n    deploymentDependsOn:\n      - 'redis'\n    github:\n      repository: 'vmelikyan/lc-test'\n      branchName: 'main'\n      docker:\n        builder:\n          engine: 'buildkit'\n        defaultTag: 'main'\n        app:\n          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'\n          env:\n            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'\n            TEST_TEST: 'test'\n            WHAT: \"is-this\"\n          ports:\n            - 8080\n      deployment:\n        public: true\n        resource:\n          cpu:\n            request: '10m'\n          memory:\n            request: '50Mi'\n        readiness:\n          tcpSocketPort: 8080\n        hostnames:\n          host: '0env.com'\n          defaultInternalHostname: 'lc-test-dev-0'\n          defaultPublicUrl: 'lc-test-dev-0.0env.com'\n\n  # - name: 'postgres-db'\n  #   docker:\n  #     dockerImage: 'postgres'\n  #     defaultTag: '14.3-alpine'\n  #     ports:\n  #       - 5432\n  #     env:\n  #       POSTGRES_USER: 'postgres_user'\n  #       POSTGRES_PASSWORD: 'mysecretpassword'\n  #       POSTGRES_DB: 'postgres_db'\n  #       SERVICE: 'postgres-db'\n  #       PGDATA: '/var/lib/postgresql/data/pgdata'\n  #     deployment:\n  #       public: false\n  #       resource:\n  #         cpu:\n  #           request: '10m'\n  #         memory:\n  #           request: '100Mi'\n  #       readiness:\n  #         tcpSocketPort: 5432\n  #       serviceDisks:\n  #         - name: 'postgres-volume'\n  #           mountPath: '/var/lib/postgresql/data'\n  #           accessModes: 'ReadWriteOnce'\n  #           storageSize: '5Gi'\n\n  - name: \"postgres-db\"\n    helm:\n      repository: \"vmelikyan/lc-test\"\n      branchName: \"main\"\n      chart:\n        name: \"postgresql\"\n        valueFiles:\n          - 'sysops/helm/lfc/db/db.yaml'\n\n  - name: \"redis\"\n    deploymentDependsOn:\n      - 'postgres-db'\n    helm:\n      repository: \"vmelikyan/lc-test\"\n      branchName: \"main\"\n      chart:\n        name: \"redis\"\n\n  - name: \"jenkins\"\n    helm:\n      repository: \"vmelikyan/lc-test\"\n      branchName: \"main\"\n      chart:\n        name: \"jenkins\"\n        repoUrl: \"https://charts.bitnami.com/bitnami\"\n        version: \"13.6.8\"\n        values:\n          - \"service.type=ClusterIP\"\n          - \"ingress.enabled=true\"\n          - \"ingress.hostname={{jenkins_publicUrl}}\"\n          - \"ingress.ingressClassName=nginx\"\n\n  - name: \"nginx\"\n    defaultUUID: \"dev-0\"\n    docker:\n      dockerImage: \"nginx\"\n      defaultTag: \"latest\"\n      ports:\n        - 80\n      deployment:\n        public: true\n        resource:\n          cpu:\n            request: \"10m\"\n          memory:\n            request: \"200Mi\"\n        readiness:\n          tcpSocketPort: 80\n