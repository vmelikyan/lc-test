---
version: '1.0.0'

environment:
  defaultServices:
    - name: 'lc-test'
    - name: 'redis-helm'
    - name: 'grpc-echo'

    
services:
  - name: "lc-test"
    requires:
      - name: "pos-discount-claims-kinesis"
    helm:
      repository: 'vmelikyan/lc-test'
      branchName: 'main'
      chart:
        name: 'goodrx-app'
        valueFiles:
          - 'sysops/helm/common.yaml'
          - 'sysops/helm/lfc/service/app.yaml'
      docker:
        defaultTag: 'main'
        app:
          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'
          env:
            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'
            TEST_TEST: 'test'
            WHAT: "is-this"
          ports:
            - 8080  
  
  - name: "grpc-echo"
    helm:
      repository: "vmelikyan/lc-test"
      branchName: "main"
      grpc: true
      chart:
        name: 'goodrx-app'
        valueFiles:
          - 'sysops/helm/common.yaml'
          - 'sysops/helm/lfc/service/grpc-service.yaml'
      docker:
        defaultTag: "main"
        app:
          dockerfilePath: "grpc-echo/Dockerfile"
          ports:
            - 8080
          env:
            COMPONENT: "app"
            ENV: "lifecycle"

   - name: pos-discount-claims-kinesis
    defaultUUID: "good-dev-0"
    docker:
      dockerImage: "localstack/localstack"
      defaultTag: "2.0.1"
      ports:
        - 4566
      env:
        SERVICES: "kinesis"
        PERSISTENCE: "1"
        KINESIS_INITIALIZE_STREAMS: "rwd-segment-raw-events-stream:1:us-west-2"
        EAGER_SERVICE_LOADING: "1"
        LS_LOG: "warn"
      deployment:
        public: false
        capacityType: "ON_DEMAND"
        resource:
          cpu:
            request: "10m"
          memory:
            request: "100Mi"
        readiness:
          tcpSocketPort: 4566
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 1
          successThreshold: 1
          failureThreshold: 10
        serviceDisks:
          - name: "localstack-volume"
            mountPath: "/localstack/data"
            accessModes: "ReadWriteOnce"
            storageSize: "1Gi"

  - name: "redis-helm"
    helm:
      repository: "vmelikyan/lc-test"
      branchName: "main"
      chart:
        name: "redis"


        

