---
version: '1.0.0'

environment:
  defaultServices:
    - name: 'lc-test'
    # - name: 'redis-helm'
    # - name: 'grpc-echo'
    # - name: 'postgres-helm'
    # - name: 'lc-helm-test'
    # - name: 'mysql-helm'
    # - name: 'elasticsearch-helm'
    - name: 'grafana'
    
services:
  - name: 'lc-test'
    defaultUUID: 'good-dev-0'
    github:
      repository: 'vmelikyan/lc-test'
      branchName: 'main'
      docker:
        defaultTag: 'main'
        app:
          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'
          env:
            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'
          ports:
            - 8080
        init:
          dockerfilePath: 'sysops/dockerfiles/init.dockerfile'
      deployment:
        public: true
        capacityType: 'SPOT'
        resource:
          cpu:
            request: '10m'
          memory:
            request: '100Mi'
        readiness:
          tcpSocketPort: 8080
          httpGet:
            port: 8080
  
  - name: "grpc-echo"
    helm:
      name: 'goodrx-app'
      repository: "vmelikyan/lc-test"
      branchName: "main"
      grpc: true
      chart:
        name: 'goodrx-app'
        valueFiles:
          - 'sysops/helm/common.yaml'
          - 'sysops/helm/lfc/service/grpc-service.yaml'
      docker:
        defaultTag: "main"
        app:
          dockerfilePath: "grpc-echo/Dockerfile"
          ports:
            - 8080
          env:
            COMPONENT: "app"
            
  - name: "lc-helm-test"
    helm:
      name: 'goodrx-app'
      repository: 'vmelikyan/lc-test'
      branchName: 'main'
      chart:
        name: 'goodrx-app'
      docker:
        defaultTag: 'main'
        app:
          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'
          env:
            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'
            TEST_TEST: 'test'
          ports:
            - 8080
            
  - name: "postgres-helm"
    helm:
      name: 'postgresql'
      repository: 'vmelikyan/lc-test'
      branchName: 'main'
      chart:
        name: 'postgresql'
        values:
          - "auth.username=postgres"
          - "auth.password=vahanspassword"
        valueFiles:
            - 'sysops/helm/lfc/db/db.yaml'

  - name: "grafana"
    helm:
      name: 'grafana'
      repository: 'vmelikyan/lc-test'
      branchName: 'main'
      version: '3.7.2'
      args: '--reuse-values --debug --timeout 60m0s'
      action: 'install'
      chart:
        name: 'grafana'
        repoUrl: 'https://charts.bitnami.com/bitnami'
        version: '9.1.2'
        values:
        valueFiles:

  - name: "redis-helm"
    helm:
      name: "redis"
      repository: "vmelikyan/lc-test"
      branchName: "main"
      chart:
        name: "redis"
        
  - name: "mysql-helm"
    helm:
      name: "mysql"
      repository: "vmelikyan/lc-test"
      branchName: "main"
      chart:
        name: "mysql"
        
  - name: "elasticsearch-helm"
    helm:
      name: "elasticsearch"
      repository: "vmelikyan/lc-test"
      branchName: "main"
      chart:
        name: "elasticsearch"

        

