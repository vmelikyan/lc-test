---
version: '1.0.0'

environment:
  defaultServices:
    - name: 'lc-test'
    - name: 'grpc-echo'
    - name: 'yolo-db'

services:
  - name: 'lc-test'
    defaultUUID: 'good-dev-0'
    github:
      repository: 'vmelikyan/lc-test'
      branchName: 'main'
      docker:
        defaultTag: 'main'
        app:
          dockerfilePath: 'sysops/dockerfiles/app.dockerfile'
          env:
            CLIENT_HOST: '{{grpc-echo_internalHostname}}:8080'
          ports:
            - 8080
        init:
          dockerfilePath: 'sysops/dockerfiles/init.dockerfile'
      deployment:
        helm:
          enabled: true
        public: true
        capacityType: 'SPOT'
        resource:
          cpu:
            request: '10m'
          memory:
            request: '100Mi'
        readiness:
          tcpSocketPort: 8080
          httpGet:
            port: 8080

  - name: "grpc-echo"
    github:
      repository: "vmelikyan/lc-test"
      branchName: "main"
      docker:
        defaultTag: "main"
        app:
          dockerfilePath: "grpc-echo/Dockerfile"
          ports:
            - 8080
          env:
            COMPONENT: "app"
      deployment:
        public: true
        capacityType: "SPOT"
        resource:
          cpu:
            request: "10m"
          memory:
            request: "100Mi"
        readiness:
          tcpSocketPort: 8090
          httpGet:
            path: "/__lbheartbeat__"
            port: 8090
        hostnames:
          host: 'lifecycle.dev.goodrx.com'
          defaultInternalHostname: 'grpc-echo-good-dev-0'
          defaultPublicUrl: 'grpc-echo-good-dev-0.lifecycle.dev.goodrx.com'
        network:
          grpc:
            enable: true
            host: "lifecycle-grpc.dev.goodrx.com"
            defaultHost: "grpc-echo-good-dev-0.lifecycle-grpc.dev.goodrx.com"

  - name: "yolo-db"
    docker:
      dockerImage: "postgres"
      defaultTag: "14.6-alpine"
      ports:
        - 5432
      env:
        POSTGRES_USER: "postgres"
        POSTGRES_PASSWORD: "mysecretpassword"
        POSTGRES_DB: "postgres"
        PGDATA: "/var/lib/postgresql/data/pgdata"
      deployment:
        helm:
          enabled: true
          customValueFiles:
            - './sysops/helm/common.yaml'
            - './sysops/helm/${{ENV}}/db/db.yaml'
